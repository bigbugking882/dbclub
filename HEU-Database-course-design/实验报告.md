# 校园社团管理系统 实验报告

本报告基于项目源码与作者提供的 Readme，按指定格式展开数据库设计、实现与应用开发部分，便于复现与评估。

## 1. 选题背景
随着高校社团活动数量与管理复杂度增加，传统人工登记、线下通知等方式难以满足高效管理需求。本项目实现一个校园社团管理系统，提供社团管理、活动发布、成员管理与活动报名等功能，便于管理员和成员协同管理和参与活动。

## 2. 需求分析

### 2.1 数据需求分析
- 用户信息：用户名、密码、手机号、角色、注册时间等。
- 社团信息：社团 ID、名称、简介、创始人、创建时间、类别与审核状态等。
- 成员关联信息：用户与社团的多对多关系、成员角色、加入时间、审核状态。
- 活动信息：活动 ID、所属社团、标题、内容、时间、地点、状态、发起人。
- 报名信息：用户对活动的报名记录、报名时间与出席状态。
- 验证码临时数据（测试环境用表或 Redis）：手机号、验证码、过期时间。

（说明：以上数据表结构已在 `数据库代码/campus_club.sql` 中给出，本报告在第 3 节详细列出表结构与约束。）

### 2.2 功能需求分析
- 用户管理：登录、身份鉴别（role 区分管理员/普通用户/系统管理员）。注意：当前版本已删除注册流程，需在数据库中初始化用户。
- 社团管理：社团创建、编辑、删除、审核、状态管理。
- 成员管理：成员加入申请、管理员审核、成员列表维护、成员角色设置（社长/管理员/社员）。
- 活动管理：发布活动、编辑活动、删除活动、活动审核、活动状态更新（未开始/进行中/已结束）。
- 活动报名：用户报名活动、报名唯一性限制、出席签到标记。
- 查询浏览：社团列表、活动列表、我的社团/我的活动等展示功能。

### 2.3 非功能需求分析
- 可用性：前端使用 Vue 提供 SPA，交互响应快速，用户体验良好。
- 可维护性：后端采用 Flask，路由清晰，便于扩展 API。
- 可扩展性：数据库使用 MySQL，表设计支持扩展字段，Redis 可用于缓存和会话扩展。
- 安全性：应支持密码加密存储、接口鉴权（当前演示版本密码为明文，建议改进）。
- 性能：为中小规模校园场景设计，使用索引与外键约束保证查询效率与完整性，必要时可加 Redis 缓存常用查询。

## 3. 数据库设计

以下内容基于 `数据库代码/campus_club.sql` 文件（已在仓库），并补充设计说明与完善建议。

### 3.1 概念结构设计（ER 概览）
- 实体：User（用户）、Club（社团）、Activity（活动）。
- 关系：User 与 Club 为多对多关系（通过 Club_Member 关联）；Club 与 Activity 为一对多关系；User 与 Activity 通过 Activity_Signup 为多对多关系（报名）。

ER 图（文字版）：
- User (1) <--> (N) Club_Member (N) <--> (1) Club
- Club (1) --> (N) Activity
- User (1) <--> (N) Activity_Signup (N) <--> (1) Activity

### 3.2 逻辑结构设计（表结构说明）
下面摘录并说明 SQL文件中关键表的字段、约束与说明：

- 表：`user`
  - 字段：`id`(PK), `username`, `password`, `telephone`(UNIQUE), `role`, `create_time`
  - 说明：角色 0-普通用户、1-社团管理员、2-系统管理员。注意：示例 SQL 中密码为明文，生产环境应使用哈希（如 bcrypt）。

- 表：`club`
  - 字段：`club_id`(PK), `club_name`(UNIQUE), `description`, `founder_id`(FK->user.id), `create_time`, `status`, `category`, `audit_status`
  - 说明：包含社团的审核状态与运行状态，创始人通过外键关联到 `user`。

- 表：`club_member`
  - 字段：`member_id`(PK), `user_id`(FK->user.id), `club_id`(FK->club.club_id), `role`, `join_time`, `audit_status`
  - 约束：`UNIQUE(user_id, club_id)`，避免重复加入；外键 ON DELETE CASCADE 确保引用完整性。

- 表：`activity`
  - 字段：`activity_id`(PK), `club_id`(FK->club.club_id), `title`, `content`, `start_time`, `end_time`, `location`, `status`, `create_time`, `creator_id`(FK->user.id)

- 表：`activity_signup`
  - 字段：`signup_id`(PK), `activity_id`(FK->activity.activity_id), `user_id`(FK->user.id), `signup_time`, `is_attend`
  - 约束：`UNIQUE(user_id, activity_id)`，防止重复报名。

- 表：`vercode_temp`
  - 用于临时验证码存储（测试环境），在生产中建议使用 Redis 实现高并发与短时态数据管理。

（完整表定义请参见 `数据库代码/campus_club.sql`）

### 3.3 安全性与完整性设计
- 完整性约束：通过主键、外键和唯一索引保证实体一致性；例如 `club_member` 中的外键与 `uk_user_club` 唯一约束。
- 事务与并发：对于关键的写操作（如成员申请、活动报名）应在后端使用数据库事务，防止并发导致的重复插入或不一致状态。
- 身份鉴权与权限控制：后端应在每个受保护接口校验用户身份与角色（如仅 role >=1 的用户可进行社团管理）。
- 密码与敏感数据：当前 SQL 示例中密码为明文（仅测试），生产应使用安全哈希（bcrypt/scrypt/argon2）并加盐存储。验证码与会话数据建议使用 Redis，避免存储到持久表中。
- 网络安全：启用 HTTPS、后端校验输入、避免 SQL 注入（使用参数化查询或 ORM）。

### 3.4 物理结构设计
- 存储引擎与字符集：使用 InnoDB 引擎与 utf8mb4 字符集（已在 SQL 中设置），支持事务、外键与多语言字符。
- 索引策略：
  - 主键索引自动建立。
  - 唯一索引：`user.telephone`、`club.club_name`、`club_member(user_id,club_id)`、`activity_signup(user_id,activity_id)` 等。
  - 可根据查询频率为 `activity.start_time`、`club.category`、`activity.creator_id` 添加普通索引以加速检索。
- 分表与分区：当前设计适用于校园规模数据（中小量），如未来数据量显著增长，可考虑按时间或社团分区活动表或使用读写分离/分库分表策略。

## 4. 数据库实施

### 4.1 创建数据库
在 MySQL 中执行 SQL 文件开头的创建语句即可创建数据库与表。示例（PowerShell）：
```powershell
# 进入项目根或数据库目录
cd .\数据库代码
mysql -u root -p < .\campus_club.sql
```
该脚本会先 DROP 再 CREATE 数据库（脚本中包含 DROP DATABASE），请在生产或重要数据环境中谨慎执行。

如果你更希望手动创建数据库并逐表执行建表语句，可在 Navicat、MySQL Workbench 或命令行中运行相应建表段落。

### 4.2 加载数据
脚本中包含若干 INSERT 语句用于初始化测试用户、社团、成员与活动数据。执行完整 SQL 文件会同时创建结构与插入测试数据。

注意事项：
- 确保 `config.py` 中数据库名与连接授权的用户存在并具有访问权限。
- 若不想覆盖已有数据库，可先备份或删除 SQL 文件中 DROP DATABASE 段落后再执行。

## 5. 数据库应用程序设计

> 说明：你给出的模板中包含“考练”相关条目（可能为课程作业模板）。在本系统上下文中，我将“考练列表/作答/统计信息”映射为“活动列表/报名与签到/统计信息（活动参与统计）”。下面按该映射展开设计。

### 5.1 系统功能模块图
- 模块划分（逻辑层）：
  - 用户模块：登录鉴权、用户信息查询
  - 社团模块：社团管理、社团列表、社团审核
  - 成员模块：成员申请、审核、成员列表
  - 活动模块：活动发布/编辑/删除、活动列表、活动详情
  - 报名模块：活动报名、报名管理、签到/出席标记
  - 统计模块：活动参与统计、社团成员统计

（图示建议：前端 Vue 组件层 -> 后端 Flask 控制器层 -> 数据库持久层）

### 5.2 考练列表（映射为 活动列表）
- 前端展示活动列表（分页/筛选：按社团、时间、状态、关键字）。
- 后端提供 API：GET /api/activities?club_id=&status=&page=&size=，返回活动摘要（id、title、start_time、location、status、club_name）。

### 5.3 考练作答（映射为 报名/签到）
- 报名流程：用户在活动详情页点击报名，后端检查 `activity_signup` 表中是否已有记录（唯一约束），若无则插入报名记录。
- 签到流程：活动进行时，管理员或发起者可以标记出席（更新 `is_attend` 字段为 1）。

### 5.4 统计信息
- 活动统计：单个活动的报名人数、出席率（出席 / 报名）。
- 社团统计：按社团统计成员数、活动数、近 N 天内活动参与总人数。
- 实现建议：使用 SQL 聚合查询（COUNT、SUM、GROUP BY），并在高并发场景下把热点统计放入 Redis 缓存并定期刷新。

## 6. 数据库应用程序开发

本节说明后端与前端如何与数据库交互，并给出关键实现要点与代码位置提示（基于仓库结构）。

### 6.1 数据库连接
- 后端入口与配置：`后端代码/config.py` 包含数据库连接配置（用户名、密码、host、port、database）。
- 建议：在 `app.py` 中使用 SQLAlchemy 或 PyMySQL（视实际代码）进行连接，并使用连接池以复用连接、提高性能。
- 连接示例（伪代码）：
```python
# config.py 中配置
DB_URI = 'mysql+pymysql://user:pwd@localhost:3306/campus_club?charset=utf8mb4'

# app 初始化
from flask_sqlalchemy import SQLAlchemy
app.config['SQLALCHEMY_DATABASE_URI'] = DB_URI
db = SQLAlchemy(app)
```

### 6.2 考练列表管理（活动列表管理）
- 后端 API：
  - GET /api/activities -> 返回分页活动列表
  - GET /api/activities/:id -> 返回活动详情
  - POST /api/activities -> 创建活动（需权限）
  - PUT /api/activities/:id -> 编辑活动（需权限）
  - DELETE /api/activities/:id -> 删除活动（需权限）
- 实现要点：校验 `club_id` 是否存在，校验发起者是否为社团管理员或社长，使用事务包裹多表写入。

### 6.3 考练作答详情（报名详情）
- 报名 API：
  - POST /api/activity_signup -> 用户报名（body 包含 activity_id, user_id）
  - GET /api/activity_signup?activity_id= -> 活动报名列表（管理员查看）
  - PUT /api/activity_signup/:id -> 更新出席状态（签到）
- 并发控制：在报名路由中检查唯一约束并使用事务或在插入前加行级锁以防重复报名（但 SQL 中已配置 UNIQUE 约束作为最后防线）。

### 6.4 统计信息
- 后端提供统计 API，例如：
  - GET /api/stats/activity/:id -> 返回报名人数、出席人数、出席率
  - GET /api/stats/club/:id -> 返回社团成员数、活动数等
- SQL 示例（统计报名人数）：
```sql
SELECT COUNT(*) AS signup_count FROM activity_signup WHERE activity_id = ?;
SELECT SUM(is_attend) AS attend_count FROM activity_signup WHERE activity_id = ?;
```

## 7. 数据库应用系统运行环境
- 操作系统：Windows（开发环境），服务器可选 Linux 部署。
- 数据库：MySQL 8.x（脚本已在 `数据库代码/campus_club.sql` 中按 utf8mb4 与 InnoDB 配置）。
- 缓存：Redis（可选，用于验证码、会话、热点统计缓存）。
- 后端：Python 3.x，Flask，依赖见 `后端代码/requirements.txt`。
- 前端：Node.js + npm，Vue.js 项目位于 `前端代码/sjk`。

运行依赖（主要步骤回顾）：
1. 导入数据库并建立表（参见第 4 节）。
2. 启动 Redis（如使用）。
3. 后端：创建虚拟环境，安装 requirements，修改 `config.py` 为本地数据库与 Redis 配置，运行 `python app.py`。
4. 前端：在 `前端代码/sjk` 目录运行 `npm install`，然后 `npm run serve`。

## 8. 案例总结
- 本项目提供了完整的校园社团管理系统骨架，覆盖用户、社团、成员、活动与报名的核心功能。数据库设计遵循关系模型范式，使用外键、唯一约束与适度索引保证一致性与查询性能。
- 当前演示版本便于教学与学习：包含示例数据、前端页面与后端接口，但仍有若干可改进点：
  1. 密码存储需改为安全哈希。
  2. 恢复/完善注册与验证码流程（建议使用 Redis 存验证码）。
  3. 增加后端单元测试与接口自动化测试，保证 API 的稳定性。
  4. 增强权限控制、日志记录与错误处理。

后续我可以：
- 将本报告保存为 PDF（需你允许我在仓库中生成 PDF 或你在本地转换 Markdown），
- 或继续为项目添加单元测试、完善后端鉴权与密码加密、或把报告拆成教学 PPT。

---
文件位置：本报告已保存为 `实验报告.md`，数据库脚本位置为 `数据库代码/campus_club.sql`。
