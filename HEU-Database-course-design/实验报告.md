# 校园社团管理系统 实验报告

本报告基于项目源码与作者提供的 Readme，按指定格式展开数据库设计、实现与应用开发部分，便于复现与评估。

## 1. 选题背景
随着高校社团活动数量与管理复杂度增加，传统人工登记、线下通知等方式难以满足高效管理需求。本项目实现一个校园社团管理系统，提供社团管理、活动发布、成员管理与活动报名等功能，便于管理员和成员协同管理和参与活动。

## 2. 需求分析

### 2.1 数据需求分析
- 用户信息：用户名、密码、手机号、角色、注册时间等。
- 社团信息：社团 ID、名称、简介、创始人、创建时间、类别与审核状态等。
- 成员关联信息：用户与社团的多对多关系、成员角色、加入时间、审核状态。
- 活动信息：活动 ID、所属社团、标题、内容、时间、地点、状态、发起人。
- 报名信息：用户对活动的报名记录、报名时间与出席状态。
- 验证码临时数据（测试环境用表或 Redis）：手机号、验证码、过期时间。

（说明：以上数据表结构已在 `数据库代码/campus_club.sql` 中给出，本报告在第 3 节详细列出表结构与约束。）

### 2.2 功能需求分析
- 用户管理：登录、身份鉴别（role 区分管理员/普通用户/系统管理员）。注意：当前版本已删除注册流程，需在数据库中初始化用户。
- 社团管理：社团创建、编辑、删除、审核、状态管理。
- 成员管理：成员加入申请、管理员审核、成员列表维护、成员角色设置（社长/管理员/社员）。
- 活动管理：发布活动、编辑活动、删除活动、活动审核、活动状态更新（未开始/进行中/已结束）。
- 活动报名：用户报名活动、报名唯一性限制、出席签到标记。
- 查询浏览：社团列表、活动列表、我的社团/我的活动等展示功能。

### 2.3 非功能需求分析
- 可用性：前端使用 Vue 提供 SPA，交互响应快速，用户体验良好。
- 可维护性：后端采用 Flask，路由清晰，便于扩展 API。
- 可扩展性：数据库使用 MySQL，表设计支持扩展字段，Redis 可用于缓存和会话扩展。
- 安全性：应支持密码加密存储、接口鉴权（当前演示版本密码为明文，建议改进）。
- 性能：为中小规模校园场景设计，使用索引与外键约束保证查询效率与完整性，必要时可加 Redis 缓存常用查询。

## 3. 数据库设计

以下内容基于 `数据库代码/campus_club.sql` 文件（已在仓库），并补充设计说明与完善建议。

### 3.1 概念结构设计（ER 概览）
- 实体：User（用户）、Club（社团）、Activity（活动）。
- 关系：User 与 Club 为多对多关系（通过 Club_Member 关联）；Club 与 Activity 为一对多关系；User 与 Activity 通过 Activity_Signup 为多对多关系（报名）。

ER 图（文字版）：
- User (1) <--> (N) Club_Member (N) <--> (1) Club
- Club (1) --> (N) Activity
- User (1) <--> (N) Activity_Signup (N) <--> (1) Activity

### 3.2 逻辑结构设计

为了方便描述，在本节后续的数据模型中采用表 3-1 符号表示特定含义。

#### 表 3-1 数据模型描述符号
| 编号 | 符号 | 含义             |
| ---- | ---- | ---------------- |
| 1    | FK   | 外键 (Foreign Key) |
| 2    | PRI  | 主键约束         |
| 3    | UNI  | 唯一约束         |

### 1. 实体与联系的逻辑模型
基于分析得到的实体与联系，将其逐一转换成关系逻辑模型。

#### (1) 实体转换
表 3-2 展示了如何将每个实体单独转换成一个独立的关系。

### 表 3-2 实体转换表
| 编号 | 实体   | 实体转换说明与转换形成的关系 |
| ---- | ------ | ---------------------------- |
| 1    | 用户   | user(user_id, username, password, contact, role, register_time) |
| 2    | 社团   | club(club_id, name, description, create_time, category, founder_id, status) |
| 3    | 活动   | activity(activity_id, name, description, start_time, end_time, location, club_id, status) |

#### (2) 联系转换
表 3-3 展示了如何按照联系类型分别转换各个联系。有的联系需要创建新关系，有的则需要在已有关系中增加属性。

### 表 3-3 联系转换表
| 编号 | 联系类型         | 联系转换说明与转换形成的关系 |
| ---- | ---------------- | ---------------------------- |
| 1    | 用户与社团 (1:N) | 在 `club` 表中增加 `founder_id` 外键，表示社团创始人 |
| 2    | 用户与社团 (M:N) | 新建 `member` 表，包含 `user_id` 和 `club_id` 外键，表示用户与社团的多对多关系 |
| 3    | 社团与活动 (1:N) | 在 `activity` 表中增加 `club_id` 外键，表示活动所属社团 |
| 4    | 用户与活动 (1:N) | 在 `activity` 表中增加 `creator_id` 外键，表示活动创建者 |
| 5    | 用户与活动 (M:N) | 新建 `signup` 表，包含 `user_id` 和 `activity_id` 外键，表示用户与活动的多对多关系 |

### 2. 关系模式的优化
如前所示，所有的实体与联系经过初步转换和合并之后，共计 5 个关系。针对这些关系，需进行规范化理论分析与优化。

#### 示例分析
1. **member (user_id, club_id, role)**：
   - 该关系的码是 `(user_id, club_id)`，不存在非主属性对主属性的部分函数依赖和传递函数依赖，因此满足 BCNF。
2. **signup (user_id, activity_id, status)**：
   - 该关系的码是 `(user_id, activity_id)`，不存在非主属性对主属性的部分函数依赖和传递函数依赖，因此满足 BCNF。

### 3. 外模式设计
根据实际需求，设计以下视图：
1. **用户视图**：
   - `user_view`：包含用户的基本信息（`user_id`, `username`, `contact`, `role`）。
2. **社团视图**：
   - `club_view`：包含社团的基本信息（`club_id`, `name`, `description`, `status`）。
3. **活动视图**：
   - `activity_view`：包含活动的基本信息（`activity_id`, `name`, `start_time`, `location`, `status`）。

### 3.3 安全性与完整性设计

校园社团管理系统的安全性设计主要涉及权限管理、数据加密存储、SQL 注入防止等方面。

#### 权限管理
系统中主要涉及普通用户和管理员两种角色，各种角色在系统中的权限有所不同：
- **普通用户**：可以注册、登录、创建社团、申请加入社团、报名活动。
- **管理员**：可以审核社团创建申请、审核成员加入申请、审核活动报名申请，并管理所有用户、社团和活动的基本信息。

#### 数据加密
用户的密码信息使用 MD5 加密后存储，确保数据安全性。

#### SQL 防注入
系统使用 Flask 框架开发，框架本身具有 SQL 防注入功能，开发中无需特别考虑。

#### 数据完整性设计

根据校园社团管理系统的实际需求，设计了以下完整性约束和触发器：

##### 1. 实体完整性
- `user` 表的 `user_id` 为主键，确保每个用户唯一标识。
- `club` 表的 `club_id` 为主键，确保每个社团唯一标识。
- `activity` 表的 `activity_id` 为主键，确保每个活动唯一标识。
- `member` 表的 `(user_id, club_id)` 作为联合主键，确保用户与社团的唯一关系。
- `signup` 表的 `(user_id, activity_id)` 作为联合主键，确保用户与活动的唯一报名记录。

##### 2. 参照完整性
- `club` 表的 `founder_id` 为外键，引用 `user` 表的 `user_id`，确保社团创始人必须是有效用户。
- `activity` 表的 `club_id` 为外键，引用 `club` 表的 `club_id`，确保活动所属社团必须存在。
- `activity` 表的 `creator_id` 为外键，引用 `user` 表的 `user_id`，确保活动创建者必须是有效用户。
- `member` 表的 `user_id` 为外键，引用 `user` 表的 `user_id`，`club_id` 为外键，引用 `club` 表的 `club_id`，确保成员与社团的关系有效。
- `signup` 表的 `user_id` 为外键，引用 `user` 表的 `user_id`，`activity_id` 为外键，引用 `activity` 表的 `activity_id`，确保报名记录有效。

##### 3. 用户自定义完整性
- `user` 表的 `role` 字段取值范围：
  - `0` 表示普通用户。
  - `1` 表示管理员。
- `club` 表的 `status` 字段取值范围：
  - `0` 表示待审核。
  - `1` 表示已通过。
  - `2` 表示已拒绝。
- `activity` 表的 `status` 字段取值范围：
  - `0` 表示未开始。
  - `1` 表示进行中。
  - `2` 表示已结束。

##### 4. 触发器设计
- **触发器 T1**：
  - 触发条件：当 `activity` 表的 `status` 字段更新为 `2`（已结束）。
  - 动作：自动更新 `signup` 表中对应 `activity_id` 的报名记录状态为 `已结束`。
- **触发器 T2**：
  - 触发条件：当 `member` 表中插入新记录时。
  - 动作：检查 `user` 表中对应的 `user_id` 是否存在，若不存在则回滚插入操作。
- **触发器 T3**：
  - 触发条件：当 `club` 表的 `status` 字段更新为 `1`（已通过）。
  - 动作：通知社团创始人审核结果（通过日志或消息队列实现）。

### 3.4 物理结构设计

### 数据存储
为了提高系统的高可用性，选择主备架构，定期备份主库的数据，防止数据丢失。

### 数据存取
重点考虑索引设计，示例如下：
1. **索引设计**：
   - `user` 表中对 `user_id` 和 `email` 字段创建主键索引。
   - `club` 表中对 `club_id` 和 `creator_id` 字段创建主键索引。
   - `activity` 表中对 `activity_id` 和 `organizer_id` 字段创建主键索引。

## 4 数据库实施

### 4.1 创建数据库
根据最终完成的关系模式设计，将每个关系写成建表语句，执行建库和建表操作。以下是部分建表示例：

```sql
CREATE TABLE user (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    email VARCHAR(100) NOT NULL UNIQUE,
    username VARCHAR(100) NOT NULL,
    password VARCHAR(100) NOT NULL,
    role INT NOT NULL,
    register_time DATETIME NOT NULL
);

CREATE TABLE club (
    club_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    creator_id INT NOT NULL,
    FOREIGN KEY (creator_id) REFERENCES user(user_id)
);

CREATE TABLE activity (
    activity_id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(100) NOT NULL,
    description TEXT,
    organizer_id INT NOT NULL,
    FOREIGN KEY (organizer_id) REFERENCES user(user_id)
);

CREATE TABLE member (
    member_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    club_id INT NOT NULL,
    role VARCHAR(50),
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    FOREIGN KEY (club_id) REFERENCES club(club_id)
);

CREATE TABLE signup (
    signup_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    activity_id INT NOT NULL,
    status VARCHAR(50),
    FOREIGN KEY (user_id) REFERENCES user(user_id),
    FOREIGN KEY (activity_id) REFERENCES activity(activity_id)
);
```

### 4.2 加载数据
待数据库表创建完成后，手动生成少量测试数据，包括用户、社团、活动等部分的必要数据，用于测试系统的基础功能。随后，借助脚本生成大量数据，模拟真实场景，重点测试系统的稳定性和性能。

## 5. 数据库应用程序设计

#### 5.1 系统功能模块图

校园社团管理系统采用 Vue.js 前端框架和 Flask 后端框架实现，遵循“高内聚，低耦合”的设计思想。系统分为两个主要模块：用户管理模块和社团管理模块。整体的系统模块图如图 5-1 所示，各个模块的详细功能说明如表 5-1 所示。

##### 图 5-1 校园社团管理系统模块图
1. **用户管理模块**：实现用户的注册、登录、个人信息管理等功能。
2. **社团管理模块**：包括社团的创建、成员管理、活动发布与报名等核心功能。

##### 表 5-1 详细功能模块列表
| 编号 | 应用模块 | 子模块       | 功能简介                     | 对应页面          | 权限       |
| ---- | -------- | ------------ | ---------------------------- | ----------------- | ---------- |
| 1    | 用户管理 | 登录         | 用户登录                     | Login.vue          | 所有人     |
| 2    | 用户管理 | 注册         | 用户注册                     | Register.vue       | 所有人     |
| 3    | 用户管理 | 用户主页     | 普通用户的个人主页           | UserHome.vue       | 普通用户   |
| 4    | 用户管理 | 管理员主页   | 管理员的管理页面             | AdminHome.vue      | 管理员     |
| 5    | 社团管理 | 社团列表     | 查看所有社团信息             | ClubList.vue       | 普通用户   |
| 6    | 社团管理 | 社团管理     | 管理社团的详细信息           | ClubManage.vue     | 管理员     |
| 7    | 社团管理 | 我的社团     | 查看用户加入的社团           | MyClubs.vue        | 普通用户   |
| 8    | 活动管理 | 活动列表     | 查看所有活动信息             | ActivityList.vue   | 普通用户   |
| 9    | 活动管理 | 活动管理     | 管理活动的详细信息           | ActivityManage.vue | 管理员     |
| 10   | 活动管理 | 我的活动     | 查看用户报名的活动           | MyActivities.vue   | 普通用户   |
| 11   | 成员管理 | 成员管理     | 管理社团成员信息             | MemberManage.vue   | 管理员     |
| 12   | 用户管理 | 用户管理     | 管理所有用户信息             | UserManage.vue     | 管理员     |

#### 5.2 活动列表

活动列表页面显示当前用户可以报名的所有活动。活动的状态分为三种情况：
- **未开始**（蓝色）：活动尚未开始，用户可以报名。
- **进行中**（绿色）：活动正在进行中，用户可以参与。
- **已结束**（灰色）：活动已结束，用户无法报名或参与。

用户可以通过筛选条件（如社团名称、活动时间等）快速查找感兴趣的活动。

#### 5.3 活动管理

##### 用户报名活动
普通用户可以选择感兴趣的活动进行报名。报名时，系统会检查用户是否已报名该活动，若未报名则插入报名记录。报名成功后，用户可以在“我的活动”页面查看已报名的活动。

##### 管理员管理活动
管理员可以查看所有活动的报名情况，包括报名人数、活动状态等信息。管理员还可以对活动进行以下操作：
- 修改活动信息（如时间、地点）。
- 取消活动。
- 审核用户的报名申请。

#### 5.4 统计信息

##### 普通用户统计信息
普通用户登录后，可以在“我的统计”页面查看个人的活动参与情况，包括：
- 已报名活动数量。
- 已参与活动数量。
- 活动参与率（参与活动数量 / 报名活动数量）。

##### 管理员统计信息
管理员登录后，可以在“社团统计”页面查看社团的整体数据，包括：
- 社团成员数量。
- 活动发布数量。
- 活动报名人数。
- 活动参与率（参与人数 / 报名人数）。

管理员还可以点击具体活动，查看每个活动的详细统计数据，包括：
- 报名用户列表。
- 用户的参与状态（已报名、已参与、未参与）。
- 活动的整体参与率。

#### 5.5 登录页面

登录页面是用户进入系统的入口，主要功能包括：
- 用户输入用户名和密码进行身份验证。
- 验证通过后，根据用户角色（普通用户或管理员）跳转到对应的主页。
- 若验证失败，页面会提示错误信息（如“用户名或密码错误”）。

页面设计特点：
- 提供简单明了的输入框和登录按钮。
- 支持“记住我”功能，方便用户下次快速登录。

#### 5.6 注册页面

注册页面允许新用户创建账户，主要功能包括：
- 用户填写基本信息（如用户名、密码、手机号）。
- 系统验证输入信息的合法性（如密码强度、手机号格式）。
- 注册成功后，用户可以使用新账户登录。

页面设计特点：
- 提供清晰的表单布局，确保用户易于填写。
- 提供实时验证提示，帮助用户纠正错误输入。

#### 5.7 用户主页

用户主页是普通用户登录后的主界面，主要功能包括：
- 显示用户的基本信息（如用户名、加入的社团）。
- 提供快捷入口，方便用户访问“我的社团”、“我的活动”等页面。

页面设计特点：
- 采用卡片式布局，直观展示用户信息。
- 提供导航栏，方便用户切换到其他功能页面。

#### 5.8 管理员主页

管理员主页是管理员登录后的主界面，主要功能包括：
- 显示系统的统计信息（如社团总数、活动总数）。
- 提供快捷入口，方便管理员访问“社团管理”、“活动管理”等页面。

页面设计特点：
- 采用仪表盘式布局，直观展示系统数据。
- 提供操作按钮，方便管理员快速执行管理任务。

#### 5.9 我的社团页面

“我的社团”页面显示用户加入的所有社团，主要功能包括：
- 列出社团的基本信息（如名称、简介）。
- 提供快捷入口，方便用户查看社团详情或退出社团。

页面设计特点：
- 采用列表式布局，清晰展示社团信息。
- 提供操作按钮，方便用户管理社团参与情况。

#### 5.10 我的活动页面

“我的活动”页面显示用户报名的所有活动，主要功能包括：
- 列出活动的基本信息（如标题、时间、状态）。
- 提供快捷入口，方便用户查看活动详情或取消报名。

页面设计特点：
- 采用卡片式布局，直观展示活动信息。
- 提供筛选功能，方便用户快速查找特定活动。

#### 5.11 数据库应用程序开发

数据库应用程序开发是校园社团管理系统的核心部分，主要包括以下几个方面：

##### 1. 后端接口设计
后端使用 Flask 框架开发，提供 RESTful API 接口，主要功能包括：
- 用户管理：实现用户登录、身份验证等功能。
- 社团管理：支持社团的创建、编辑、删除和审核。
- 活动管理：提供活动的发布、编辑、删除和状态更新接口。
- 报名管理：实现用户报名活动、取消报名和签到功能。

接口设计遵循以下原则：
- **安全性**：通过 JWT（JSON Web Token）实现接口鉴权，确保用户身份合法。
- **高效性**：使用分页查询、索引优化等技术提升接口响应速度。
- **可扩展性**：接口设计支持未来功能扩展，例如增加更多筛选条件。

##### 2. 数据库操作
数据库使用 MySQL，主要操作包括：
- 数据插入：如用户注册、活动发布时的数据写入。
- 数据查询：如获取社团列表、活动列表时的多表联查。
- 数据更新：如修改活动状态、更新用户信息。
- 数据删除：如删除社团、取消活动。

为保证数据操作的安全性和一致性，采用以下措施：
- 使用事务（Transaction）处理复杂操作，避免数据不一致。
- 使用预处理语句（Prepared Statement）防止 SQL 注入攻击。
- 定期备份数据库，防止数据丢失。

##### 3. 前后端交互
前端通过 Axios 库与后端进行通信，主要流程如下：
1. 前端发送 HTTP 请求（如 GET、POST）。
2. 后端接收请求，处理业务逻辑，并返回 JSON 格式的响应数据。
3. 前端根据响应数据更新页面内容。

为提升用户体验，前后端交互设计了以下优化：
- **错误处理**：前端捕获接口错误（如网络异常、权限不足），并提示用户。
- **加载状态**：在请求未完成时，显示加载动画，避免用户误操作。
- **数据缓存**：对频繁访问的数据（如社团列表）进行本地缓存，减少接口调用次数。

##### 4. 测试与调试
为确保系统稳定性和可靠性，开发过程中进行了充分的测试与调试：
- **单元测试**：对后端接口的核心功能（如用户登录、活动发布）进行单元测试。
- **集成测试**：模拟前后端交互流程，验证接口的正确性。
- **性能测试**：使用工具（如 JMeter）模拟高并发场景，评估系统性能。
- **错误调试**：通过日志记录和调试工具（如 Postman）定位并修复问题。

通过以上开发与测试，系统实现了高效、稳定的数据库应用功能，满足校园社团管理的需求。

## 6. 数据库应用程序开发

### 6.1 数据库连接

在校园社团管理系统中，后端使用 Flask 框架与 MySQL 数据库进行连接。为了提升系统性能和资源利用率，推荐使用数据库连接池技术。以下是两种常见的数据库连接方式：

#### 1. 使用普通连接
普通连接通过 `pymysql` 库实现，配置如下：
```python
import pymysql

connection = pymysql.connect(
    host='127.0.0.1',
    user='user1',
    password='123456',
    database='campus_club',
    charset='utf8mb4'
)
```
这种方式适用于小型应用，但在高并发场景下性能较低。

#### 2. 使用连接池
推荐使用 `SQLAlchemy` 的连接池功能，配置如下：
```python
from sqlalchemy import create_engine

engine = create_engine(
    'mysql+pymysql://user1:123456@127.0.0.1:3306/campus_club',
    pool_size=10,
    max_overflow=20,
    pool_timeout=30,
    pool_recycle=1800
)
```
连接池技术可以显著提升系统性能，减少频繁创建和销毁连接的开销。

### 6.2 活动列表管理

活动列表管理功能包括活动的查询、筛选和状态展示。以下是主要实现：

#### 1. 数据模型（Model）
活动表的定义如下：
```sql
CREATE TABLE activity (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    start_time DATETIME,
    end_time DATETIME,
    status ENUM('未开始', '进行中', '已结束') DEFAULT '未开始',
    club_id INT,
    FOREIGN KEY (club_id) REFERENCES club(id)
);
```

#### 2. 业务逻辑（View）
后端通过 Flask 提供活动列表的 API 接口：
```python
from flask import Flask, jsonify, request
from sqlalchemy.orm import sessionmaker

app = Flask(__name__)
Session = sessionmaker(bind=engine)

@app.route('/api/activities', methods=['GET'])
def get_activities():
    session = Session()
    club_id = request.args.get('club_id')
    activities = session.execute(
        "SELECT * FROM activity WHERE club_id = :club_id ORDER BY start_time DESC",
        {'club_id': club_id}
    ).fetchall()
    session.close()
    return jsonify([dict(row) for row in activities])
```

#### 3. 前端页面（Template）
前端通过 Vue.js 实现活动列表页面，主要代码如下：
```html
<template>
  <div>
    <h1>活动列表</h1>
    <ul>
      <li v-for="activity in activities" :key="activity.id">
        <h3>{{ activity.title }}</h3>
        <p>{{ activity.description }}</p>
        <p>状态: {{ activity.status }}</p>
      </li>
    </ul>
  </div>
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      activities: []
    };
  },
  mounted() {
    axios.get('/api/activities?club_id=1')
      .then(response => {
        this.activities = response.data;
      });
  }
};
</script>
```

### 6.3 活动详情管理

活动详情页面提供活动的详细信息展示和报名功能，主要实现包括：
- **数据模型**：活动表和报名表的关联。
- **业务逻辑**：查询活动详情和处理用户报名。
- **前端页面**：展示活动详情和报名按钮。

### 6.4 统计信息

统计信息模块通过分析活动和用户数据，生成图表展示关键指标。主要实现包括：
- **数据模型**：统计表记录用户参与活动的数据。
- **业务逻辑**：计算活动参与率、用户活跃度等指标。
- **前端页面**：使用图表库（如 ECharts）展示统计结果。

通过以上功能模块的开发，校园社团管理系统实现了高效的数据库应用功能，满足了用户的实际需求。
